{
	"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"applicationId": {
			"type": "string",
			"defaultValue": "",
			"metadata": {
				"comments": "Application ID in ServiceNow",
				"required": false
			}
		},
		"productId": {
			"type": "string",
			"defaultValue": "",
			"metadata": {
				"comments": "Application PR in ServiceNow",
				"required": false
			}
		},
		"productLine": {
			"type": "string",
			"defaultValue": "",
			"metadata": {
				"comments": "Application PL in ServiceNow",
				"required": false
			}
		},
		"employeeId": {
			"type": "string",
			"defaultValue": "",
			"metadata": {
				"comments": "Employee ID",
				"required": false
			}
		},
		"businessUnit": {
			"type": "string",
			"defaultValue": "wi",
			"metadata": {
				"comments": "Business Unit. Examples: 'wi', 'ecc', 'gs'",
				"required": false
			}
		},
		"environment": {
			"type": "string",
			"defaultValue": "dev",
			"metadata": {
				"comments": "Deployment Environment",
				"required": false
			}
		},
		"organization": {
			"type": "string",
			"defaultValue": "WIM",
			"metadata": {
				"comments": "Organization",
				"required": false
			}
		},
		"timestamp": {
			"type": "string",
			"defaultValue": "[utcNow('u')]"
		},

		"location": {
			"type": "string",
			"defaultValue": "[resourceGroup().location]"
		},
		"functionName": {
			"type": "string",
			"defaultValue": "[concat(parameters('applicationId'), '-', parameters('employeeId'), '-s-app')]",
			"metadata": {
				"required": true
			}
		},
		"virtualNetworkResourceGroup": {
			"type": "string",
			"defaultValue": "[concat(parameters('businessUnit'), '-', parameters('environment'), '-', parameters('productLine'), '-', parameters('location'), '-network')]"
		},
		"virtualNetworkName": {
			"type": "string",
			"defaultValue": "[concat(parameters('businessUnit'), '-', parameters('environment'), '-', parameters('productLine'), '-', parameters('location'), '-vnet')]",
			"metadata": {
				"comments": "You should have one VNet at the PL level. If it is named <businessUnit>-<environment>-<productLine>-<location>-vnet, this is not required.",
				"required": false
			}
		},
		"subnetNameForVNetIntegration": {
			"type": "string",
			"defaultValue": "[concat(parameters('businessUnit'), '-', parameters('environment'), '-', parameters('productId'), '-app-sbt')]",
			"metadata": {
				"comments": "You should have subnets in your VNet, at the PR level, specifically for functions. If it is named <businessUnit>-<environment>-<productId>-app-sbt, this is not required.",
				"required": false
			}
		}
	},
	"variables": {
		"subnetIdForVNetIntegration": "[concat(resourceId(parameters('virtualNetworkResourceGroup'), 'Microsoft.Network/virtualNetworks', parameters('virtualNetworkName')), '/subnets/', parameters('subnetNameForVNetIntegration'))]",
		"resourceTags": {
			"ApplicationId": "[toLower(parameters('applicationId'))]",
			"ProductId": "[toLower(parameters('productId'))]",
			"ProductLine": "[toLower(parameters('productLine'))]",
			"CreatedBy": "[toLower(parameters('employeeId'))]",
			"BusinessUnit": "[parameters('businessUnit')]",
			"Environment": "[toLower(parameters('environment'))]",
			"Organization": "[parameters('organization')]",
			"Timestamp": "[parameters('timestamp')]"
		},
		"apiVersionNet": "2020-06-01",
		"apiVersionWeb": "2020-06-01"
	},
	"resources": [
		{
			"type": "Microsoft.Web/sites",
			"apiVersion": "[variables('apiVersionWeb')]",
			"name": "[parameters('functionName')]",
			"location": "[parameters('location')]",
			"kind": "functionapp",
			"tags": "[variables('resourceTags')]",
			"properties": {},
			"resources": [
				{
					"type": "config",
					"apiVersion": "[variables('apiVersionNet')]",
					"name": "virtualNetwork",
					"location": "[parameters('location')]",
					"dependsOn": [
						"[resourceId('Microsoft.Web/sites', parameters('functionName'))]"
					],
					"properties": {
						"subnetResourceId": "[variables('subnetIdForVNetIntegration')]",
						"swiftSupported": true
					}
				}
			]
		}
	]
}